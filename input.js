function _0xe87a(_0x2983ff,_0x19e00a){const _0x141313=_0x1413();return _0xe87a=function(_0xe87a54,_0x4183c3){_0xe87a54=_0xe87a54-0xcd;let _0x6effa1=_0x141313[_0xe87a54];return _0x6effa1;},_0xe87a(_0x2983ff,_0x19e00a);}const _0x3ddcfe=_0xe87a;function _0x1413(){const _0x6e11c1=['env','error','🐢\x20离开关键时间窗口\x20|\x20请求次数:\x20','existsSync','success','successTimes','fixed','🚀\x20初始关键窗口减速监控\x20|\x20请求次数:\x20','get','天\x20|\x20请求次数:\x20','test','utf8','库存不足','mb2capp_sports_exchangeHealthCoins','mode','random','lastMinute','daily_limit','message','requestCount','getMinutes','达到每日请求上限','currentInterval','dailyStats','...\x20|\x20请求次数:\x20','code','6444885uoYvNs','2985704iZshXI','currentDate','lastUpdated','21103','1376758oVywPa','push','subtract','🚀\x20进入关键时间窗口\x20|\x20请求次数:\x20','substring','🧹\x20清理历史数据，保留最近','toFixed','log','stringify','⚠️\x20请求异常','now','发送通知失败:','includes','🌿\x20初始常规监控\x20|\x20请求次数:\x20','filter','lastNotificationTime','./sendNotify','97384sQQtJv','JD_COOKIE','intervalMultiplier','开始时间:\x20','38RbzVgLNjFbTjLjG7BSP1cBovRw','开始监控兑换','format','5984208gfbqpv','data','dailyRequests','getHours','min','\x20-\x20','验证通过','🔄\x20切换到随机模式\x20|\x20请求次数:\x20','兑换监控已启动','步数不足','451222QxeALC','YYYY-MM-DD','✅\x20兑换成功','保存历史数据失败:','lastRequestTime','未知响应:\x20','3038214iHxkrn','forEach','读取历史数据失败:','COUPON_ID','🔄\x20','请查看日志\x0a请求次数:\x20','writeFileSync','3llNcrO','🐢\x20减速请求:\x20间隔增加至\x20','📢\x20发送通知:\x20','553UcDzrQ','🔄\x20新的一天开始:\x20','inKeyWindow','🎲\x20随机间隔:\x20','请求次数:\x20','兑换成功','🛑\x20达到每日请求上限','⚠️\x20请求异常:\x20','days','🔐\x20Cookie验证','sendNotify','readFileSync','lastError','parse','monitoring','jdapp','🚨\x20中断等待，进入关键窗口\x20|\x20请求次数:\x20','⏳\x20等待\x20','\x20|\x20请求次数:\x20','🎉\x20兑换成功!\x20','moment','status','209501','msg','⏳\x20跳过通知:\x20','abs','floor'];_0x1413=function(){return _0x6e11c1;};return _0x1413();}(function(_0x5d4e4b,_0x411540){const _0x259403=_0xe87a,_0x3ba73c=_0x5d4e4b();while(!![]){try{const _0x39b75a=parseInt(_0x259403(0xf7))/0x1+parseInt(_0x259403(0xd5))/0x2*(-parseInt(_0x259403(0x104))/0x3)+parseInt(_0x259403(0xd1))/0x4+parseInt(_0x259403(0xd0))/0x5+parseInt(_0x259403(0xfd))/0x6+-parseInt(_0x259403(0x107))/0x7*(parseInt(_0x259403(0xe6))/0x8)+-parseInt(_0x259403(0xed))/0x9;if(_0x39b75a===_0x411540)break;else _0x3ba73c['push'](_0x3ba73c['shift']());}catch(_0x4a4299){_0x3ba73c['push'](_0x3ba73c['shift']());}}}(_0x1413,0xa5894));const JD_COOKIE=process['env'][_0x3ddcfe(0xe7)]||'',COUPON_ID=process[_0x3ddcfe(0x122)][_0x3ddcfe(0x100)]||_0x3ddcfe(0xea),KEY_MINUTES=[0x0,0xa,0x14,0x1e,0x28,0x32],WINDOW_SIZE=0x2,INIT_INTERVAL=0x3e8,MAX_INTERVAL=0x2710,INTERVAL_INCREMENT=0x3e8,KEY_WINDOW_RANDOM_MIN=0x1388,KEY_WINDOW_RANDOM_MAX=0x9c40,MIN_RANDOM_INTERVAL=0x7530,MAX_RANDOM_INTERVAL=0x15f90,MAX_DAILY_REQUESTS=0x5dc,SAFE_INTERVAL=0x5dc,HISTORY_DAYS=0x7,STATUS_CHECK_INTERVAL=0x2710,API_URL='https://api.m.jd.com/api',ORIGIN_HEADER='https://laputa.jd.com',HISTORY_FILE_PATH='/ql/data/scripts/jd_health_history.json',fs=require('fs'),axios=require('axios'),moment=require(_0x3ddcfe(0x11b)),loadHistory=()=>{const _0x2fb078=_0x3ddcfe;try{if(fs[_0x2fb078(0x125)](HISTORY_FILE_PATH)){const _0x9d53cd=fs[_0x2fb078(0x112)](HISTORY_FILE_PATH,_0x2fb078(0x12d));return JSON[_0x2fb078(0x114)](_0x9d53cd);}}catch(_0x1ba11c){console[_0x2fb078(0xdc)](_0x2fb078(0xff),_0x1ba11c[_0x2fb078(0x134)]);}return{'successTimes':[],'lastUpdated':0x0,'dailyStats':{}};},saveHistory=_0x1d02d6=>{const _0x3b171f=_0x3ddcfe;try{fs[_0x3b171f(0x103)](HISTORY_FILE_PATH,JSON[_0x3b171f(0xdd)](_0x1d02d6),'utf8');}catch(_0x5b0ff8){console[_0x3b171f(0xdc)](_0x3b171f(0xfa),_0x5b0ff8['message']);}},addSuccessTime=()=>{const _0x667617=_0x3ddcfe,_0x3b1ccf=loadHistory(),_0x2a8784=new Date(),_0x118d0d=moment(_0x2a8784)[_0x667617(0xec)]('YYYY-MM-DD');!_0x3b1ccf['dailyStats'][_0x118d0d]&&(_0x3b1ccf[_0x667617(0xcd)][_0x118d0d]={'successTimes':[],'requestCount':0x0});const _0x3df242=_0x2a8784[_0x667617(0xf0)]()+':'+_0x2a8784['getMinutes']()['toString']()['padStart'](0x2,'0');_0x3b1ccf[_0x667617(0xcd)][_0x118d0d][_0x667617(0x127)][_0x667617(0xd6)](_0x3df242),_0x3b1ccf[_0x667617(0x127)]['push']({'time':_0x3df242,'date':_0x118d0d}),_0x3b1ccf[_0x667617(0xd3)]=Date[_0x667617(0xdf)](),saveHistory(_0x3b1ccf),console[_0x667617(0xdc)]('📝\x20记录成功时间:\x20'+_0x3df242);};let state={'dailyRequests':0x0,'lastRequestTime':0x0,'status':'monitoring','currentInterval':MIN_RANDOM_INTERVAL,'inKeyWindow':![],'success':![],'message':'','lastError':'','intervalMultiplier':0x1,'lastMinute':-0x1,'mode':_0x3ddcfe(0x128),'windowStartTime':0x0,'currentDate':'','lastNotificationTime':0x0,'lastStatusCheck':0x0};const safeRequest=async()=>{const _0x1f1b3d=_0x3ddcfe,_0x282344=Date[_0x1f1b3d(0xdf)](),_0x3d0390=_0x282344-state[_0x1f1b3d(0xfb)];if(_0x3d0390<SAFE_INTERVAL){const _0x1a495e=SAFE_INTERVAL-_0x3d0390;console[_0x1f1b3d(0xdc)]('🛡️\x20风控保护:\x20等待'+formatTime(_0x1a495e)),await new Promise(_0x519294=>setTimeout(_0x519294,_0x1a495e));}if(state[_0x1f1b3d(0xef)]>=MAX_DAILY_REQUESTS)return console[_0x1f1b3d(0xdc)](_0x1f1b3d(0x10d)),state[_0x1f1b3d(0x134)]=_0x1f1b3d(0x137),{'error':_0x1f1b3d(0x133)};state['dailyRequests']++,state[_0x1f1b3d(0xfb)]=_0x282344;const _0x57b1e0=loadHistory(),_0x31353d=moment(_0x282344)['format']('YYYY-MM-DD');_0x57b1e0[_0x1f1b3d(0xcd)][_0x31353d]&&(_0x57b1e0[_0x1f1b3d(0xcd)][_0x31353d][_0x1f1b3d(0x135)]++,saveHistory(_0x57b1e0));try{const _0x685735=await axios[_0x1f1b3d(0x12a)](API_URL,{'params':{'functionId':_0x1f1b3d(0x12f),'body':JSON['stringify']({'encryptAssignmentId':COUPON_ID}),'appid':'laputa','client':'m'},'headers':{'Cookie':JD_COOKIE,'User-Agent':_0x1f1b3d(0x116),'Origin':ORIGIN_HEADER,'Connection':'keep-alive'},'timeout':0x9c4});return{'data':_0x685735[_0x1f1b3d(0xee)]};}catch(_0x1f243f){return{'error':_0x1f243f[_0x1f1b3d(0x134)]};}},processResult=_0x497c6a=>{const _0x3e376c=_0x3ddcfe;if(_0x497c6a['error']){if(_0x497c6a[_0x3e376c(0x123)]==='daily_limit')return state['status']='stopped',![];return console[_0x3e376c(0xdc)]('⚠️\x20请求错误:\x20'+_0x497c6a['error']),state[_0x3e376c(0x113)]=_0x497c6a['error'],!![];}try{const _0x38b18f=_0x497c6a['data'];if(_0x38b18f[_0x3e376c(0x126)])return state['status']=_0x3e376c(0x126),state[_0x3e376c(0x134)]=_0x38b18f[_0x3e376c(0x11e)]||'兑换成功',console[_0x3e376c(0xdc)](_0x3e376c(0x11a)+state['message']+_0x3e376c(0x119)+state[_0x3e376c(0xef)]),addSuccessTime(),![];if(_0x38b18f[_0x3e376c(0xcf)]===_0x3e376c(0x11d))return state[_0x3e376c(0x134)]=_0x38b18f[_0x3e376c(0x11e)]||_0x3e376c(0xf6),console[_0x3e376c(0xdc)]('⛔\x20'+state[_0x3e376c(0x134)]+_0x3e376c(0x119)+state['dailyRequests']),!![];if(_0x38b18f[_0x3e376c(0xcf)]===_0x3e376c(0xd4))return state[_0x3e376c(0x134)]=_0x38b18f[_0x3e376c(0x11e)]||'库存不足',console[_0x3e376c(0xdc)]('🔄\x20'+state['message']+_0x3e376c(0x119)+state[_0x3e376c(0xef)]),!![];state[_0x3e376c(0x134)]=_0x38b18f['msg']||_0x3e376c(0xfc)+_0x38b18f[_0x3e376c(0xcf)],console[_0x3e376c(0xdc)]('❓\x20'+state[_0x3e376c(0x134)]+_0x3e376c(0x119)+state[_0x3e376c(0xef)]);}catch(_0xb543ad){if(/(成功|抢到了|太棒了|恭喜|已抢到)/i['test'](JSON[_0x3e376c(0xdd)](_0x497c6a[_0x3e376c(0xee)])))return state[_0x3e376c(0x11c)]='success',state[_0x3e376c(0x134)]=_0x3e376c(0x10c),console['log']('🎉\x20兑换成功!\x20|\x20请求次数:\x20'+state[_0x3e376c(0xef)]),addSuccessTime(),![];if(/(步数不足|209501)/i[_0x3e376c(0x12c)](JSON['stringify'](_0x497c6a[_0x3e376c(0xee)])))return state[_0x3e376c(0x134)]=_0x3e376c(0xf6),console[_0x3e376c(0xdc)]('⛔\x20'+state['message']+'\x20|\x20请求次数:\x20'+state['dailyRequests']),!![];if(/(库存不足|21103)/i[_0x3e376c(0x12c)](JSON['stringify'](_0x497c6a[_0x3e376c(0xee)])))return state[_0x3e376c(0x134)]=_0x3e376c(0x12e),console[_0x3e376c(0xdc)](_0x3e376c(0x101)+state[_0x3e376c(0x134)]+_0x3e376c(0x119)+state['dailyRequests']),!![];state[_0x3e376c(0x134)]='未知响应',console['log']('❓\x20'+state[_0x3e376c(0x134)]+':\x20'+JSON['stringify'](_0x497c6a[_0x3e376c(0xee)])[_0x3e376c(0xd9)](0x0,0x32)+'...\x20|\x20请求次数:\x20'+state['dailyRequests']);}return!![];},isInKeyWindow=()=>{const _0x40cf56=_0x3ddcfe,_0x34c156=new Date(),_0x1ad75a=_0x34c156[_0x40cf56(0x136)]();for(const _0xf5b55a of KEY_MINUTES){if(Math[_0x40cf56(0x120)](_0x1ad75a-_0xf5b55a)<=WINDOW_SIZE)return!![];}return![];},updateMonitoringState=()=>{const _0x346994=_0x3ddcfe,_0x21e770=new Date(),_0x20d148=_0x21e770[_0x346994(0x136)]();if(_0x20d148===state[_0x346994(0x132)])return;state[_0x346994(0x132)]=_0x20d148;const _0x1ecc80=isInKeyWindow();if(_0x1ecc80&&!state['inKeyWindow'])console[_0x346994(0xdc)](_0x346994(0xd8)+state[_0x346994(0xef)]),state[_0x346994(0x109)]=!![],state['windowStartTime']=Date[_0x346994(0xdf)](),state['currentInterval']=INIT_INTERVAL,state['intervalMultiplier']=0x1,state['mode']=_0x346994(0x128),sendNotification('🚀\x20监控窗口开始',_0x346994(0xf5),_0x346994(0xe9)+formatTime(Date[_0x346994(0xdf)]())+'\x0a请求次数:\x20'+state[_0x346994(0xef)]);else!_0x1ecc80&&state[_0x346994(0x109)]&&(console[_0x346994(0xdc)](_0x346994(0x124)+state['dailyRequests']),state['inKeyWindow']=![],state['mode']=_0x346994(0x131),state[_0x346994(0x138)]=generateRandomInterval(MIN_RANDOM_INTERVAL,MAX_RANDOM_INTERVAL));},executeDeceleratingRequest=async()=>{const _0x21c390=_0x3ddcfe;while(state[_0x21c390(0x109)]&&state[_0x21c390(0x130)]===_0x21c390(0x128)){try{const _0x53f80a=await safeRequest(),_0x4cdd9b=processResult(_0x53f80a);if(!_0x4cdd9b){state[_0x21c390(0x11c)]===_0x21c390(0x126)&&sendNotification(_0x21c390(0xf9),state[_0x21c390(0x134)],_0x21c390(0x10b)+state[_0x21c390(0xef)]);state[_0x21c390(0x11c)]=_0x21c390(0x115),state[_0x21c390(0x126)]=![],state[_0x21c390(0x134)]='';return;}const _0xc3b46d=Math['min'](INIT_INTERVAL+state['intervalMultiplier']*INTERVAL_INCREMENT,MAX_INTERVAL);console['log'](_0x21c390(0x105)+formatTime(_0xc3b46d)+_0x21c390(0x119)+state['dailyRequests']),state[_0x21c390(0x138)]=_0xc3b46d,state[_0x21c390(0xe8)]++;if(_0xc3b46d>=MAX_INTERVAL){console[_0x21c390(0xdc)](_0x21c390(0xf4)+state[_0x21c390(0xef)]),state[_0x21c390(0x130)]=_0x21c390(0x131),state['currentInterval']=generateRandomInterval(KEY_WINDOW_RANDOM_MIN,KEY_WINDOW_RANDOM_MAX);return;}await waitWithInterrupt(state[_0x21c390(0x138)]);}catch(_0x920b2b){console['log'](_0x21c390(0x10e)+_0x920b2b[_0x21c390(0x134)]+_0x21c390(0x119)+state[_0x21c390(0xef)]),state[_0x21c390(0x113)]=_0x920b2b[_0x21c390(0x134)],sendNotification('⚠️\x20请求异常',_0x920b2b[_0x21c390(0x134)],_0x21c390(0x102)+state[_0x21c390(0xef)]);}}},waitWithInterrupt=async _0x5c0703=>{const _0x40acbd=_0x3ddcfe,_0x9567c2=Date[_0x40acbd(0xdf)](),_0x5a899c=_0x9567c2+_0x5c0703;console[_0x40acbd(0xdc)](_0x40acbd(0x118)+formatTime(_0x5c0703)+_0x40acbd(0xce)+state[_0x40acbd(0xef)]);while(Date[_0x40acbd(0xdf)]()<_0x5a899c){const _0x6d0f65=_0x5a899c-Date['now'](),_0x27e69a=Math[_0x40acbd(0xf1)](_0x6d0f65,STATUS_CHECK_INTERVAL);await new Promise(_0x509112=>setTimeout(_0x509112,_0x27e69a)),updateMonitoringState();if(state[_0x40acbd(0x109)]&&state[_0x40acbd(0x130)]===_0x40acbd(0x128)){console[_0x40acbd(0xdc)](_0x40acbd(0x117)+state[_0x40acbd(0xef)]);return;}}},formatTime=_0x405b52=>{const _0xf3c95a=_0x3ddcfe;if(_0x405b52<0x3e8)return _0x405b52+'ms';const _0x3705eb=_0x405b52/0x3e8;if(_0x3705eb<0x3c)return _0x3705eb[_0xf3c95a(0xdb)](0x1)+'秒';const _0x5f5491=_0x3705eb/0x3c;if(_0x5f5491<0x3c)return _0x5f5491[_0xf3c95a(0xdb)](0x1)+'分钟';const _0x133d89=_0x5f5491/0x3c;return _0x133d89[_0xf3c95a(0xdb)](0x1)+'小时';},sendNotification=(_0x376f5b,_0x4ee974,_0x4d6b47)=>{const _0x3ecfb2=_0x3ddcfe,_0x51d32a=Date[_0x3ecfb2(0xdf)]();if(_0x51d32a-state[_0x3ecfb2(0xe4)]<0xea60){console[_0x3ecfb2(0xdc)](_0x3ecfb2(0x11f)+_0x376f5b+_0x3ecfb2(0xf2)+_0x4ee974+_0x3ecfb2(0x119)+state['dailyRequests']);return;}try{require(_0x3ecfb2(0xe5))[_0x3ecfb2(0x111)](_0x376f5b,_0x4ee974+'\x0a'+_0x4d6b47);}catch(_0x3887b7){console[_0x3ecfb2(0xdc)](_0x3ecfb2(0xe0),_0x3887b7[_0x3ecfb2(0x134)]);}state['lastNotificationTime']=_0x51d32a,console[_0x3ecfb2(0xdc)](_0x3ecfb2(0x106)+_0x376f5b+_0x3ecfb2(0xf2)+_0x4ee974+_0x3ecfb2(0x119)+state[_0x3ecfb2(0xef)]);},generateRandomInterval=(_0x1698d2,_0x5810e6)=>{const _0x4e6d5c=_0x3ddcfe,_0x2bf74c=Math[_0x4e6d5c(0x121)](Math[_0x4e6d5c(0x131)]()*(_0x5810e6-_0x1698d2+0x1))+_0x1698d2;return console['log'](_0x4e6d5c(0x10a)+formatTime(_0x2bf74c)+_0x4e6d5c(0x119)+state[_0x4e6d5c(0xef)]),_0x2bf74c;},checkDailyReset=()=>{const _0x307ce1=_0x3ddcfe,_0xb728e1=new Date(),_0x440baf=moment(_0xb728e1)[_0x307ce1(0xec)]('YYYY-MM-DD');if(_0x440baf!==state[_0x307ce1(0xd2)]){console[_0x307ce1(0xdc)](_0x307ce1(0x108)+_0x440baf+_0x307ce1(0x119)+state[_0x307ce1(0xef)]);const _0x5a914f=loadHistory(),_0x3734de=state['currentDate'];_0x3734de&&!_0x5a914f['dailyStats'][_0x3734de]&&(_0x5a914f[_0x307ce1(0xcd)][_0x3734de]={'successTimes':[],'requestCount':state['dailyRequests']},saveHistory(_0x5a914f)),state['dailyRequests']=0x0,state[_0x307ce1(0xd2)]=_0x440baf,cleanupHistory();}},cleanupHistory=()=>{const _0x3a27f6=_0x3ddcfe,_0xe45e1a=loadHistory(),_0x1412e2=new Date(),_0x24f64e=moment(_0x1412e2)[_0x3a27f6(0xec)]('YYYY-MM-DD'),_0x26483c=[];for(let _0x2822c4=0x0;_0x2822c4<HISTORY_DAYS;_0x2822c4++){const _0x112a4b=moment(_0x1412e2)[_0x3a27f6(0xd7)](_0x2822c4,_0x3a27f6(0x10f))[_0x3a27f6(0xec)](_0x3a27f6(0xf8));_0x26483c['push'](_0x112a4b);}Object['keys'](_0xe45e1a['dailyStats'])[_0x3a27f6(0xfe)](_0x183054=>{const _0x42b600=_0x3a27f6;!_0x26483c[_0x42b600(0xe1)](_0x183054)&&delete _0xe45e1a['dailyStats'][_0x183054];}),_0xe45e1a['successTimes']=_0xe45e1a[_0x3a27f6(0x127)][_0x3a27f6(0xe3)](_0x5de48d=>_0x26483c[_0x3a27f6(0xe1)](_0x5de48d['date'])),saveHistory(_0xe45e1a),console[_0x3a27f6(0xdc)](_0x3a27f6(0xda)+HISTORY_DAYS+_0x3a27f6(0x12b)+state[_0x3a27f6(0xef)]);},monitoringLoop=async()=>{const _0x5011e1=_0x3ddcfe;while(!![]){checkDailyReset(),updateMonitoringState();if(state[_0x5011e1(0x109)]&&state[_0x5011e1(0x130)]===_0x5011e1(0x128))await executeDeceleratingRequest();else{try{const _0x5aafc2=await safeRequest(),_0x30cce7=processResult(_0x5aafc2);!_0x30cce7&&(state[_0x5011e1(0x11c)]===_0x5011e1(0x126)&&sendNotification(_0x5011e1(0xf9),state[_0x5011e1(0x134)],'请求次数:\x20'+state[_0x5011e1(0xef)]),state['status']='monitoring',state[_0x5011e1(0x126)]=![],state[_0x5011e1(0x134)]='');}catch(_0x468503){console[_0x5011e1(0xdc)]('⚠️\x20请求异常:\x20'+_0x468503[_0x5011e1(0x134)]+_0x5011e1(0x119)+state[_0x5011e1(0xef)]),state[_0x5011e1(0x113)]=_0x468503['message'],sendNotification(_0x5011e1(0xde),_0x468503[_0x5011e1(0x134)],_0x5011e1(0x102)+state[_0x5011e1(0xef)]);}state[_0x5011e1(0x109)]?state[_0x5011e1(0x138)]=generateRandomInterval(KEY_WINDOW_RANDOM_MIN,KEY_WINDOW_RANDOM_MAX):state[_0x5011e1(0x138)]=generateRandomInterval(MIN_RANDOM_INTERVAL,MAX_RANDOM_INTERVAL),await waitWithInterrupt(state[_0x5011e1(0x138)]);}}},init=async()=>{const _0x3a0fd3=_0x3ddcfe;console['log']('🚀\x20启动京东健康智能窗口监控'),cleanupHistory();const _0x40aec8=new Date(),_0x201391=moment(_0x40aec8)[_0x3a0fd3(0xec)](_0x3a0fd3(0xf8));state={'dailyRequests':0x0,'lastRequestTime':0x0,'status':_0x3a0fd3(0x115),'inKeyWindow':isInKeyWindow(),'currentInterval':isInKeyWindow()?INIT_INTERVAL:MIN_RANDOM_INTERVAL,'success':![],'message':'','lastError':'','intervalMultiplier':0x1,'lastMinute':-0x1,'mode':_0x3a0fd3(0x128),'windowStartTime':0x0,'currentDate':_0x201391,'lastNotificationTime':0x0,'lastStatusCheck':0x0},console[_0x3a0fd3(0xdc)](state['inKeyWindow']?_0x3a0fd3(0x129)+state[_0x3a0fd3(0xef)]:_0x3a0fd3(0xe2)+state[_0x3a0fd3(0xef)]),sendNotification(_0x3a0fd3(0x110),_0x3a0fd3(0xf3),_0x3a0fd3(0xeb)),await monitoringLoop();};init();
